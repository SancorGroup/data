<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quakertown Multifamily Market Feasibility Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Corporate Calm -->
    <!-- Application Structure Plan: The application is structured as a top-down executive dashboard. It starts with a high-level summary and key conclusions, allowing users to grasp the project's viability instantly. The user can then scroll through thematic sections: Site Context, Economic & Demographic Drivers, a detailed Interactive Competitive Analysis, and finally, actionable Recommendations. This non-linear, thematic structure was chosen over the report's original format to align with a decision-maker's workflow, prioritizing the most critical information first and allowing for deeper, self-guided exploration of the underlying data. Navigation is facilitated by a sticky header for quick access to each theme. -->
    <!-- Visualization & Content Choices: 
        - Executive Summary: Goal(Inform) -> Key Metric Cards -> Static display -> Justification(Quickly convey the report's conclusion) -> HTML/Tailwind.
        - Demographic Trends: Goal(Show Change/Compare) -> Bar Chart -> Interactive buttons to switch datasets (Population/Households) -> Justification(Visualizes growth trends effectively) -> Chart.js.
        - Economic Trends: Goal(Show Change) -> Line Chart -> Interactive tooltips -> Justification(Clearly shows unemployment fluctuations over time) -> Chart.js.
        - Competitive Analysis: Goal(Compare/Organize) -> Sortable Table & Bar Chart -> Clicking table rows highlights data on the chart -> Justification(Creates a powerful tool for direct comparison of competitors against the proposed project, which is the core of the feasibility analysis) -> HTML/JS/Chart.js.
        - Recommended Unit Mix: Goal(Show Proportion) -> Donut Chart -> Interactive tooltips -> Justification(Simple, clear visualization of the recommended product mix) -> Chart.js.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: color 0.3s ease;
        }
        .nav-link:hover {
            color: #1e40af;
        }
        .stat-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .btn-active {
            background-color: #3b82f6;
            color: white;
        }
        .btn-inactive {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-inactive:hover {
            background-color: #d1d5db;
        }
        table thead th {
            cursor: pointer;
        }
    </style>
</head>
<body class="text-gray-800">

    <header id="header" class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-lg md:text-xl font-bold text-gray-900">Quakertown Market Analysis</h1>
                </div>
                <nav class="hidden md:flex md:space-x-8">
                    <a href="#overview" class="nav-link text-gray-600 font-medium">Overview</a>
                    <a href="#demographics" class="nav-link text-gray-600 font-medium">Drivers</a>
                    <a href="#competition" class="nav-link text-gray-600 font-medium">Competition</a>
                    <a href="#recommendations" class="nav-link text-gray-600 font-medium">Recommendations</a>
                </nav>
                 <div class="md:hidden">
                    <select id="mobile-nav" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                        <option value="#overview">Overview</option>
                        <option value="#demographics">Drivers</option>
                        <option value="#competition">Competition</option>
                        <option value="#recommendations">Recommendations</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">

        <section id="hero" class="text-center py-12">
            <h2 class="text-3xl md:text-4xl font-bold text-blue-900 tracking-tight">Multifamily Market Feasibility Analysis</h2>
            <p class="mt-2 text-lg text-gray-600">Proposed 48-Unit Development at 4th &amp; Chestnut St, Quakertown, PA</p>
            <div class="mt-8 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="stat-card">
                    <p class="text-sm font-medium text-gray-500">Conclusion</p>
                    <p class="text-2xl font-bold text-green-600">Project is Feasible</p>
                </div>
                <div class="stat-card">
                    <p class="text-sm font-medium text-gray-500">Projected Absorption</p>
                    <p class="text-2xl font-bold text-blue-600">4-6 Units / Month</p>
                </div>
                <div class="stat-card">
                    <p class="text-sm font-medium text-gray-500">Achievable Rent/SF</p>
                    <p class="text-2xl font-bold text-blue-600">$1.95 - $2.10</p>
                </div>
            </div>
             <p class="mt-8 max-w-3xl mx-auto text-gray-700">
                Based on a comprehensive analysis of economic, demographic, and competitive market factors, the proposed 48-unit multifamily development is well-positioned to succeed. Strong underlying demand drivers and a favorable competitive landscape support the project's viability.
            </p>
        </section>

        <div class="my-12 border-t border-gray-200"></div>

        <section id="overview" class="scroll-mt-20">
            <h3 class="text-2xl font-bold text-center text-gray-900">Project &amp; Site Overview</h3>
            <p class="mt-4 max-w-3xl mx-auto text-center text-gray-600">
                This section provides context for the proposed development and its immediate surroundings. The site's strategic location offers excellent access to local amenities and transportation networks, making it an attractive option for prospective renters in the Quakertown market.
            </p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-center bg-white p-8 rounded-lg shadow-sm">
                <div>
                    <h4 class="text-xl font-semibold">The Proposal</h4>
                    <p class="mt-2 text-gray-700">A new construction, 48-unit market-rate apartment building featuring a mix of one and two-bedroom units. The project aims to provide modern housing options to meet the growing demand in the borough.</p>
                    <ul class="mt-4 space-y-2">
                        <li class="flex items-start">
                            <span class="text-blue-500 mr-3 mt-1">&#10003;</span>
                            <span><span class="font-semibold">Location:</span> Corner of 4th &amp; Chestnut Street</span>
                        </li>
                        <li class="flex items-start">
                           <span class="text-blue-500 mr-3 mt-1">&#10003;</span>
                           <span><span class="font-semibold">Total Units:</span> 48</span>
                        </li>
                         <li class="flex items-start">
                           <span class="text-blue-500 mr-3 mt-1">&#10003;</span>
                           <span><span class="font-semibold">Unit Types:</span> One &amp; Two-Bedroom Apartments</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <h4 class="text-xl font-semibold">Neighborhood Highlights</h4>
                    <p class="mt-2 text-gray-700">The site benefits from a walkable environment with immediate access to key services and attractions.</p>
                    <ul class="mt-4 space-y-2 text-sm">
                        <li class="flex items-center"><span class="text-green-500 mr-2">&#9679;</span><span class="font-medium">Retail &amp; Dining:</span> Proximity to Broad Street's commercial corridor.</li>
                        <li class="flex items-center"><span class="text-green-500 mr-2">&#9679;</span><span class="font-medium">Recreation:</span> Near Memorial Park and other local parks.</li>
                        <li class="flex items-center"><span class="text-green-500 mr-2">&#9679;</span><span class="font-medium">Transportation:</span> Convenient access to Route 309, Route 663, and I-476.</li>
                         <li class="flex items-center"><span class="text-green-500 mr-2">&#9679;</span><span class="font-medium">Services:</span> Close to St. Luke's Upper Bucks Campus and various schools.</li>
                    </ul>
                </div>
            </div>
        </section>

        <div class="my-16 border-t border-gray-200"></div>

        <section id="demographics" class="scroll-mt-20">
            <h3 class="text-2xl font-bold text-center text-gray-900">Market Drivers: Economy &amp; Demographics</h3>
            <p class="mt-4 max-w-3xl mx-auto text-center text-gray-600">
                The viability of a new development is rooted in the underlying health of the local economy and its demographic trends. This section explores the key data points for Bucks County, revealing a stable employment base and consistent household growthâ€”both critical drivers of rental housing demand. Use the buttons below to explore different datasets.
            </p>
            <div class="mt-8 bg-white p-4 sm:p-6 md:p-8 rounded-lg shadow-sm">
                 <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                     <div class="text-center md:text-left">
                        <h4 class="text-xl font-semibold" id="chart-title">Population Trends</h4>
                        <p class="text-sm text-gray-500" id="chart-subtitle">Bucks County, 2010-2027</p>
                    </div>
                    <div class="flex space-x-2 bg-gray-100 p-1 rounded-lg">
                        <button id="pop-btn" class="btn btn-active">Population</button>
                        <button id="house-btn" class="btn btn-inactive">Households</button>
                    </div>
                 </div>
                <div class="mt-6 chart-container">
                    <canvas id="demographicsChart"></canvas>
                </div>
            </div>
             <div class="mt-8 bg-white p-4 sm:p-6 md:p-8 rounded-lg shadow-sm">
                 <div class="text-center">
                    <h4 class="text-xl font-semibold">Unemployment Rate Trends</h4>
                    <p class="text-sm text-gray-500">Bucks County vs. USA</p>
                </div>
                <div class="mt-6 chart-container">
                    <canvas id="unemploymentChart"></canvas>
                </div>
            </div>
        </section>

        <div class="my-16 border-t border-gray-200"></div>

        <section id="competition" class="scroll-mt-20">
            <h3 class="text-2xl font-bold text-center text-gray-900">Interactive Competitive Analysis</h3>
            <p class="mt-4 max-w-3xl mx-auto text-center text-gray-600">
                Understanding the existing rental market is crucial. The following table details the key comparable properties in the area. Click on any table header to sort the data, or click on a property row to highlight it on the chart below, comparing its performance against the market average and the proposed rent for the new development.
            </p>
            <div class="mt-8 bg-white p-4 sm:p-6 md:p-8 rounded-lg shadow-sm overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 text-xs text-gray-700 uppercase">
                        <tr>
                            <th scope="col" class="px-6 py-3" data-sort="name">Property Name</th>
                            <th scope="col" class="px-6 py-3" data-sort="year">Year Built</th>
                            <th scope="col" class="px-6 py-3" data-sort="units">Units</th>
                            <th scope="col" class="px-6 py-3" data-sort="occupancy">Occupancy (%)</th>
                            <th scope="col" class="px-6 py-3" data-sort="rent_sf">Avg. Rent/SF ($)</th>
                        </tr>
                    </thead>
                    <tbody id="competition-table">
                    </tbody>
                </table>
            </div>
            <div class="mt-8 bg-white p-4 sm:p-6 md:p-8 rounded-lg shadow-sm">
                <div class="text-center">
                    <h4 class="text-xl font-semibold">Rent Per Square Foot Comparison</h4>
                    <p class="text-sm text-gray-500" id="competition-chart-subtitle">Click a property in the table to compare.</p>
                </div>
                <div class="mt-6 chart-container">
                    <canvas id="competitionChart"></canvas>
                </div>
            </div>
        </section>

        <div class="my-16 border-t border-gray-200"></div>

        <section id="recommendations" class="scroll-mt-20">
            <h3 class="text-2xl font-bold text-center text-gray-900">Recommendations &amp; Projections</h3>
             <p class="mt-4 max-w-3xl mx-auto text-center text-gray-600">
                Synthesizing all market data, this final section outlines the recommended product mix, achievable rent levels, and absorption forecast. These recommendations are designed to optimize the project's performance and ensure it aligns with the identified market demand.
            </p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h4 class="text-xl font-semibold text-center">Recommended Unit Mix</h4>
                    <div class="mt-4 chart-container mx-auto" style="height: 250px; max-height: 250px;">
                        <canvas id="unitMixChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h4 class="text-xl font-semibold">Proposed Rents &amp; Features</h4>
                    <div class="space-y-4 mt-4">
                        <div>
                            <p class="font-bold text-blue-700">One-Bedroom Units (Avg. 750 SF)</p>
                            <p class="text-lg font-semibold">$1,575 / mo ($2.10 / SF)</p>
                        </div>
                        <div>
                            <p class="font-bold text-green-700">Two-Bedroom Units (Avg. 1,000 SF)</p>
                            <p class="text-lg font-semibold">$1,950 / mo ($1.95 / SF)</p>
                        </div>
                    </div>
                     <div class="mt-6">
                        <h5 class="font-semibold">Recommended Amenities</h5>
                        <ul class="list-disc list-inside text-gray-600 mt-2 text-sm">
                            <li>In-unit washer/dryer</li>
                            <li>Modern kitchens with stainless steel appliances</li>
                            <li>On-site fitness center</li>
                            <li>Community lounge / workspace</li>
                            <li>Sufficient off-street parking</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-white mt-16 border-t">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>Interactive analysis based on the report prepared by Delta Associates for Sancor Ventures, LTD. August 15, 2022.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const chartHelpers = {
                wrapText: function(text, maxLen) {
                    if (typeof text !== 'string') return [text];
                    const words = text.split(' ');
                    let lines = [];
                    let currentLine = '';
                    words.forEach(word => {
                        if ((currentLine + ' ' + word).length > maxLen && currentLine.length > 0) {
                            lines.push(currentLine);
                            currentLine = word;
                        } else {
                            currentLine = currentLine ? currentLine + ' ' + word : word;
                        }
                    });
                    lines.push(currentLine);
                    return lines;
                },
                defaultOptions: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 10,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#e5e7eb',
                            },
                             ticks: { color: '#6b7280' }
                        },
                        x: {
                            grid: {
                                display: false,
                            },
                            ticks: { color: '#6b7280' }
                        }
                    }
                }
            };

            const dataStore = {
                demographics: {
                    population: {
                        labels: ['2010', '2022', '2027 (Est.)'],
                        data: [625249, 644598, 655459],
                        title: 'Population Trends',
                        subtitle: 'Bucks County, 2010-2027'
                    },
                    households: {
                        labels: ['2010', '2022', '2027 (Est.)'],
                        data: [238321, 252061, 257760],
                        title: 'Household Trends',
                        subtitle: 'Bucks County, 2010-2027'
                    }
                },
                unemployment: {
                    labels: ['Dec 2019', 'Dec 2020', 'Dec 2021', 'Jun 2022'],
                    bucksCounty: [3.4, 5.4, 3.8, 3.5],
                    usa: [3.6, 6.7, 3.9, 3.6]
                },
                competition: [
                    { name: 'The Lofts at the Mill', year: 2021, units: 51, occupancy: 98, rent_sf: 2.13 },
                    { name: 'The Flats at the Mill', year: 2017, units: 50, occupancy: 98, rent_sf: 1.83 },
                    { name: 'Quakertown West Apts', year: 1974, units: 102, occupancy: 99, rent_sf: 1.48 },
                    { name: 'Richland Mead', year: 1988, units: 198, occupancy: 98, rent_sf: 1.63 },
                    { name: 'Patriot Square', year: 2010, units: 100, occupancy: 97, rent_sf: 1.58 },
                    { name: 'The Glen at Old Town', year: 2005, units: 120, occupancy: 96, rent_sf: 1.55 },
                ],
                unitMix: {
                    labels: ['One-Bedroom', 'Two-Bedroom'],
                    data: [28, 20]
                }
            };
            
            let sortConfig = { key: 'name', asc: true };
            let competitionChartInstance;

            function renderDemographicsChart(dataset) {
                const ctx = document.getElementById('demographicsChart').getContext('2d');
                if (window.demographicsChartInstance) {
                    window.demographicsChartInstance.destroy();
                }
                window.demographicsChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: dataStore.demographics[dataset].labels,
                        datasets: [{
                            label: 'Total',
                            data: dataStore.demographics[dataset].data,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...chartHelpers.defaultOptions,
                        plugins: { ...chartHelpers.defaultOptions.plugins, legend: { display: false } },
                        scales: {
                             y: { ...chartHelpers.defaultOptions.scales.y, beginAtZero: false, 
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                             },
                             x: { ...chartHelpers.defaultOptions.scales.x }
                        }
                    }
                });
                document.getElementById('chart-title').innerText = dataStore.demographics[dataset].title;
                document.getElementById('chart-subtitle').innerText = dataStore.demographics[dataset].subtitle;
            }

            function renderUnemploymentChart() {
                const ctx = document.getElementById('unemploymentChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dataStore.unemployment.labels,
                        datasets: [
                            {
                                label: 'Bucks County',
                                data: dataStore.unemployment.bucksCounty,
                                borderColor: 'rgba(59, 130, 246, 1)',
                                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                tension: 0.1,
                                fill: true,
                            },
                            {
                                label: 'United States',
                                data: dataStore.unemployment.usa,
                                borderColor: 'rgba(16, 185, 129, 1)',
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                tension: 0.1,
                                fill: true,
                            }
                        ]
                    },
                    options: {
                        ...chartHelpers.defaultOptions,
                        scales: {
                            y: { ...chartHelpers.defaultOptions.scales.y,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                             },
                            x: { ...chartHelpers.defaultOptions.scales.x }
                        }
                    }
                });
            }
            
            function renderCompetitionTable() {
                const tableBody = document.getElementById('competition-table');
                tableBody.innerHTML = '';

                const sortedData = [...dataStore.competition].sort((a, b) => {
                    if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.asc ? -1 : 1;
                    if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.asc ? 1 : -1;
                    return 0;
                });

                sortedData.forEach((prop, index) => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b hover:bg-gray-50 cursor-pointer';
                    row.innerHTML = `
                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${prop.name}</td>
                        <td class="px-6 py-4">${prop.year}</td>
                        <td class="px-6 py-4">${prop.units}</td>
                        <td class="px-6 py-4">${prop.occupancy}</td>
                        <td class="px-6 py-4">${prop.rent_sf.toFixed(2)}</td>
                    `;
                    row.addEventListener('click', () => {
                         updateCompetitionChart(prop.name);
                         document.querySelectorAll('#competition-table tr').forEach(r => r.classList.remove('bg-blue-100'));
                         row.classList.add('bg-blue-100');
                    });
                    tableBody.appendChild(row);
                });
            }

            function renderCompetitionChart() {
                const ctx = document.getElementById('competitionChart').getContext('2d');
                const avgRentSf = dataStore.competition.reduce((acc, curr) => acc + curr.rent_sf, 0) / dataStore.competition.length;
                
                competitionChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Market Average', 'Proposed (1-Bed)', 'Proposed (2-Bed)'],
                        datasets: [{
                            label: 'Rent per Square Foot ($)',
                            data: [avgRentSf, 2.10, 1.95],
                            backgroundColor: [
                                'rgba(107, 114, 128, 0.7)',
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(22, 163, 74, 0.7)',
                            ],
                            borderColor: [
                                'rgba(107, 114, 128, 1)',
                                'rgba(59, 130, 246, 1)',
                                'rgba(22, 163, 74, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                       ...chartHelpers.defaultOptions,
                        scales: {
                            y: {
                                ...chartHelpers.defaultOptions.scales.y,
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            },
                             x: { 
                                ...chartHelpers.defaultOptions.scales.x,
                                ticks: {
                                    ...chartHelpers.defaultOptions.scales.x.ticks,
                                    callback: function(value, index, ticks) {
                                        return chartHelpers.wrapText(this.getLabelForValue(value), 16);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            function updateCompetitionChart(propertyName) {
                const property = dataStore.competition.find(p => p.name === propertyName);
                if (!property) return;
                
                const avgRentSf = dataStore.competition.reduce((acc, curr) => acc + curr.rent_sf, 0) / dataStore.competition.length;

                const newLabels = ['Market Average', 'Proposed (1-Bed)', 'Proposed (2-Bed)', propertyName];
                const newData = [avgRentSf, 2.10, 1.95, property.rent_sf];
                const newBackgroundColors = [
                    'rgba(107, 114, 128, 0.7)',
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(22, 163, 74, 0.7)',
                    'rgba(234, 179, 8, 0.7)' 
                ];
                 const newBorderColors = [
                    'rgba(107, 114, 128, 1)',
                    'rgba(59, 130, 246, 1)',
                    'rgba(22, 163, 74, 1)',
                    'rgba(234, 179, 8, 1)'
                ];
                
                competitionChartInstance.data.labels = newLabels;
                competitionChartInstance.data.datasets[0].data = newData;
                competitionChartInstance.data.datasets[0].backgroundColor = newBackgroundColors;
                competitionChartInstance.data.datasets[0].borderColor = newBorderColors;
                competitionChartInstance.update();
                document.getElementById('competition-chart-subtitle').innerText = `Comparing ${propertyName} to market and proposal.`;
            }

            function renderUnitMixChart() {
                const ctx = document.getElementById('unitMixChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: dataStore.unitMix.labels.map((label, i) => `${label} (${dataStore.unitMix.data[i]} Units)`),
                        datasets: [{
                            data: dataStore.unitMix.data,
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                ...chartHelpers.defaultOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.raw / total) * 100).toFixed(1);
                                            label += `${context.raw} units (${percentage}%)`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const popBtn = document.getElementById('pop-btn');
            const houseBtn = document.getElementById('house-btn');

            popBtn.addEventListener('click', () => {
                renderDemographicsChart('population');
                popBtn.classList.replace('btn-inactive', 'btn-active');
                houseBtn.classList.replace('btn-active', 'btn-inactive');
            });

            houseBtn.addEventListener('click', () => {
                renderDemographicsChart('households');
                houseBtn.classList.replace('btn-inactive', 'btn-active');
                popBtn.classList.replace('btn-active', 'btn-inactive');
            });
            
            document.querySelectorAll('#competition thead th').forEach(th => {
                th.addEventListener('click', () => {
                    const key = th.dataset.sort;
                    if (sortConfig.key === key) {
                        sortConfig.asc = !sortConfig.asc;
                    } else {
                        sortConfig.key = key;
                        sortConfig.asc = true;
                    }
                    renderCompetitionTable();
                });
            });

            document.getElementById('mobile-nav').addEventListener('change', function(e) {
                const target = document.querySelector(e.target.value);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });

            renderDemographicsChart('population');
            renderUnemploymentChart();
            renderCompetitionTable();
            renderCompetitionChart();
            renderUnitMixChart();
        });
    </script>
</body>
</html>
